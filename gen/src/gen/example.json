{
	"lib" : "zapata-datum-apps",
	"namespace" : "zpt::apps",
	"resources" : [
		{
			"topic" : "/v2/datums/applications",
			"type" : "collection",
			"performatives" : [ "get", "post", "put", "patch", "delete", "head" ],
			"protocols" : [ "http", "mqtt", "0mq", "amqp" ],
			"datum" : { "name" : "zpt::apps::Applications", "opts" : [ "generate-data-access" ] }
		},
		{
			"topic" : "/v2/datums/applications/{id}",
			"type" : "document",
			"performatives" : [ "get", "post", "put", "patch", "delete", "head" ],
			"protocols" : [ "http", "mqtt", "0mq", "amqp" ],
			"datum" : { "name" : "zpt::apps::Applications", "opts" : [ "generate-data-access" ] }
		},
		{
			"topic" : "/v2/datums/applications/{app_id}/users/{user_id}/channels",
			"type" : "collection",
			"performatives" : [ "get", "post", "put", "patch", "delete", "head" ],
			"protocols" : [ "http", "mqtt", "0mq", "amqp" ],
			"datum" : { "ref" : "/v2/datums/users/{user_id}/channels", "rel" : "app_id={app_id}&user_id={user_id}" }
		}
	],
	"datums" : [
		{
			"name" : "ResourceOwners",
			"dbms" : [ "postgresql", "mongodb", "redis" ],
			"opts" : [ "generate-pk" ],
			"fields" : {
				"type" : { "type" : "ascii", "opts" : [ "mandatory", "index" ] },
				"created" : { "type" : "timestamp", "opts" : [ "auto", "mandatory" ] },
				"updated" : { "type" : "timestamp", "opts" : [ "auto", "mandatory" ] }
			}
		},
		{
			"name" : "Applications",
			"dbms" : [ "postgresql", "mongodb", "redis" ],
			"opts" : [ "generate-pk" ],
			"fields" : {
				"name" : { "type" : "utf8", "opts" : [ "mandatory" ] },
				"namespace" : { "type" : "ascii", "opts" : [ "mandatory", "unique", "index" ] },
				"app_secret" : { "type" : "token", "opts" : [ "auto", "mandatory", "index", "read-only" ] },
				"device_secret" : { "type" : "token", "opts" : [ "auto", "mandatory", "index", "read-only" ] },
				"cloud_secret" : { "type" : "token", "opts" : [ "auto", "mandatory", "index", "read-only" ] },
				"icon" : { "type" : "uri" },
				"image" : { "type" : "uri" },
				"resource_owner" : { "type" : "object", "ref" : "/v2/datums/resource-owners", "rel" : "id={id}", "opts" : [ "on-demand" ] },
				"token" :  { "type" : "object", "ref" : "/v2/datums/token", "rel" : "id={id}", "opts" : [ "on-demand" ] },
				"users" : { "type" : "array", "ref" : "/v2/datums/users", "rel" : "app_id={id}", "opts" : [ "on-demand" ] }
			}
		},
		{
			"name" : "MyApplications",
			"extends" : { "ref" : "/v2/datums/applications",  "rel" : "namespace=m/engie/i", [ "on-demand" ] },
			"fields" : {
				"channels" : { "type" : "array", "ref" : "/v2/datums/channel-subscriptions", "rel" : "app_id={id}", "opts" : [ "on-demand" ] }
			}
		}
	]
}
